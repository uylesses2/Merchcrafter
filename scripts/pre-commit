#!/bin/sh
# Pre-commit hook to block Google API Keys

echo "Running pre-commit secret check..."

# Redirect output to stderr.
exec 1>&2

# Check for AIza pattern (Strict)
# We use -E for extended regex to match AIza followed by 30+ characters.
# We also exclude the scripts directory to allow maintenance scripts to contain the pattern.
if git diff --cached --name-only -z | xargs -0 git grep -I -E "AIza[0-9A-Za-z\-_]{30,}" -- :^scripts/secret-audit.ps1 :^scripts/pre-commit; then
    echo "ERROR: Attempting to commit a file with 'AIza' pattern (Potential Google API Key)."
    echo "Please remove the key and try again."
    exit 1
fi

echo "Secret check passed."
exit 0
